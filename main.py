import numpy as np

from settings import *
from solver import *
from renderer import *

M = 2e40
D_ls = 15
D_s = model.angular_diameter_distance(0.3365).to('kpc').value
D_l = D_s - D_ls
ea2 = k = 4 * constants.G.value * M / constants.c.value ** 2 / D_l / 3.086e19 / (
            deg2rad * sec2deg / 1e3) ** 2 * D_ls / D_s
x0 = 0.1
x1 = (x0 + (x0 ** 2 + ea2) ** 0.5) / 2

M = 3.456e40
m = 5e9 * 2e30
y = -1.2
x = -7.5e-2
# x = -5.7456e-02
# y = -1.0086
d =  4.96e-3 * 4 / np.deg2rad(0.0284)
d1 = 41.9464
# print(np.deg2rad(0.0284))
D_ls = 15
d_ls = D_ls / m * M
# d = d * d_ls / D_ls
y = -0.94898
x = 1.40816e-04
x1 = 0.05
M = 3.11040e+40

# min rmse
M = 4e+39
D_ls = 292.79818965128464
x = 0.03355846126888551
y = -0.5672367316802266
x1 = 0.7479110466850444
d1 = 1660.666814255006 #2.1406568313858183 0.7174766924457416 mlce 3.2146110462289736 rmse 5.66783189163957

M = 4e+38
D_ls = 2770.780616371987
x = 0.030407071384873356
y = -0.568190649102801
x1 = 0.7541897999516314
d1 = 15285.94584342623 #2.084925750822688 0.7378284233885775 5.674041150047433
#

M = 4e+37
D_ls = 28244.078308133834
x = 0.03193449465700174
y = -0.5676848747414106
x1 = 0.7521493811995272
d1 = 141075.38728051557 #2.1317812842666415 0.8148570511046973 5.67022038838825

# M = 4e+35
# D_ls = 734182.602285559
# x=   0.10591519863630215
# y = -0.6412577991690446
# x1 = 0.7001195577893176
# d1 = 961537.6522393272 #2.0165582237062916 3.100632721551316 5.916513909863487


# M = 4e+36
# D_ls = 254894.37285762012
# x = 0.03130930358198519
# y = -0.5672738610674477
# x1 = 0.7512244027253461
# d1 = 666081.3230341104 #2.3045851203244805 1.557471237191417 5.670920894295474

M= 4e+39
D_ls = 277.1976095191484
x=  0.0006812146024436635
y = -1.0867539374073187
x1 = 0.19883212270053
d1 = 866.9942899052315 #2.0828322149014653 1.278891122106528 6.558108326724037


M = 4e+39
D_ls = 292.79818965128464
x = 0.03355846126888551
y = -0.5672367316802266
x1 = 0.7479110466850444
d1 = 1660.666814255006 #2.1406568313858183 0.7174766924457416 mlce 3.2146110462289736 rmse 5.66783189163957

M = 4e+39
D_ls = 399.2321759248575
x = 0.03233463461631521
y = -0.567794206174508
x1 = 0.7454491411825658
d1 = 2253.2890993624756 #2.4997594593459875 0.7209121099976119 5.66843074482963

# M = 4e+37
# D_ls = 41324.89940545794
# x = 0.03640418920202517
# y = -0.5688176120183742
# x1 = 0.7486693056827126
# d1 = 198439.57611707738 #2.595724438125391 0.8474621529328067 5.672241331893173

# D_ls = -200
# x = 0
# y = -1
# x1 = 0.5
# d1 = -800
# x0 = -0.2
# M=2e30
# D_ls = D_s*0.999999

solver = Solver(Lens(mass=M, D_ls=D_ls, center=np.array([x, y])),
                Source(z=0.3365, source_type='line', x0=0, x1=x1, y0=0.0, y1=-4, d0=0, d1=d1),
                filename='src/data_15kHz.txt')
# print(solver.D_l)
# print(solver.Dl2z(D_s))

renderer = Renderer(solver)
# print(solver.getSourceDirection())
# print(solver.getLensDistance() * 0.7174766924457416 / )

renderer.start()